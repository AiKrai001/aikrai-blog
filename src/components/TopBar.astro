---
---

<header id="topbar" class="topbar">
  <div class="topbar-inner">
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle sidebar">
      <i class="fas fa-bars"></i>
    </button>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="breadcrumb" aria-label="breadcrumb">
      <ol class="breadcrumb-list" id="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="/">é¦–é¡µ</a>
        </li>
      </ol>
    </nav>

    <!-- å³ä¾§å·¥å…·æ  -->
    <!-- <div class="topbar-tools"> -->
      <!-- æœç´¢æ  -->
      <!-- <div class="search-container">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            id="search-input" 
            class="search-input" 
            placeholder="æœç´¢æ–‡ç« ..."
            autocomplete="off"
          />
          <button id="search-clear" class="search-clear" aria-label="Clear search">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="search-results" class="search-results"></div>
      </div>
    </div> -->
  </div>
</header>

<style>
  .topbar {
    position: sticky;
    top: 0;
    height: var(--topbar-height);
    background-color: var(--topbar-bg);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
    z-index: 100;
  }

  .topbar-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    padding: 0 2rem;
  }

  .sidebar-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.25rem;
    transition: background-color 0.3s ease;
  }

  .sidebar-toggle:hover {
    background-color: var(--hover-bg);
  }

  .breadcrumb {
    flex: 1;
  }

  .breadcrumb-list {
    display: flex;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    font-size: 0.9rem;
    gap: 0.375rem;
  }

  .breadcrumb-item {
    display: flex;
    align-items: center;
  }

  .breadcrumb-item:not(:last-child)::after { content: none; }
  .breadcrumb-sep { color: var(--text-muted); padding: 0 0.375rem; user-select: none; }

  .breadcrumb-item a {
    color: var(--text-muted) !important;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .breadcrumb-item a:hover {
    color: var(--primary-color);
  }

  /* éæœ€åä¸€é¡¹ç»Ÿä¸€ä¸ºæ¬¡è¦è‰²ã€å¸¸è§„å­—é‡ */
  .breadcrumb-item:not(:last-child) a,
  .breadcrumb-item:not(:last-child) span {
    color: var(--text-muted) !important;
    font-weight: var(--font-weight-normal, 400);
  }
  /* æœ€åä¸€é¡¹ï¼ˆå½“å‰é¡µï¼‰åŠ æ·± */
  .breadcrumb-item:last-child span,
  .breadcrumb-item:last-child a { color: var(--text-color); font-weight: var(--font-weight-medium); }
  .breadcrumb-item:last-child a { pointer-events: none; }

  /* Global-scoped fixes so dynamically added items also style correctly */
  :global(#topbar .breadcrumb-item) {
    display: flex;
    align-items: center;
  }
  :global(#topbar .breadcrumb-sep) {
    color: var(--text-muted);
    padding: 0 0.375rem;
    user-select: none;
  }
  :global(#topbar .breadcrumb-item a),
  :global(#topbar .breadcrumb-item a:link),
  :global(#topbar .breadcrumb-item a:visited),
  :global(#topbar .breadcrumb-item a:active),
  :global(#topbar .breadcrumb-item a:focus) {
    color: var(--text-muted) !important;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  :global(#topbar .breadcrumb-item a:hover) {
    color: var(--primary-color);
  }
  :global(#topbar .breadcrumb-item:not(:last-child) a),
  :global(#topbar .breadcrumb-item:not(:last-child) span) {
    color: var(--text-muted) !important;
    font-weight: var(--font-weight-normal, 400);
  }
  :global(#topbar .breadcrumb-item:last-child span),
  :global(#topbar .breadcrumb-item:last-child a) {
    color: var(--text-color);
    font-weight: var(--font-weight-medium);
  }
  :global(#topbar .breadcrumb-item:last-child a) {
    pointer-events: none;
  }

  .topbar-tools {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .search-container {
    position: relative;
  }

  .search-box {
    position: relative;
    display: flex;
    align-items: center;
    width: 300px;
    height: 2.5rem;
    background-color: var(--input-bg);
    border: 1px solid var(--input-border);
    border-radius: var(--border-radius-lg);
    transition: all var(--transition-fast);
  }

  .search-box:focus-within {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
  }

  .search-icon {
    position: absolute;
    left: 0.75rem;
    color: var(--text-muted);
    font-size: 0.9rem;
    pointer-events: none;
  }

  .search-input {
    flex: 1;
    height: 100%;
    padding: 0 2.5rem 0 2.5rem;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text-color);
    font-size: var(--font-size-sm);
  }

  .search-input::placeholder {
    color: var(--text-muted);
  }

  .search-clear {
    position: absolute;
    right: 0.5rem;
    display: none;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 0.8rem;
    cursor: pointer;
    border-radius: 50%;
    transition: all var(--transition-fast);
  }

  .search-clear:hover {
    color: var(--text-color);
    background-color: var(--hover-bg);
  }

  .search-clear.show {
    display: flex;
  }

  .search-results {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    right: 0;
    max-height: 400px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    overflow-y: auto;
    z-index: 1000;
    display: none;
  }

  .search-results.show {
    display: block;
  }

  .search-loading,
  .search-no-results,
  .search-error {
    padding: 1rem;
    text-align: center;
    color: var(--text-muted);
    font-size: var(--font-size-sm);
  }

  .search-error {
    color: var(--danger-color);
  }

  .search-result-item {
    border-bottom: 1px solid var(--border-color);
  }

  .search-result-item:last-child {
    border-bottom: none;
  }

  .search-result-link {
    display: block;
    padding: 1rem;
    color: inherit;
    text-decoration: none;
    transition: background-color var(--transition-fast);
  }

  .search-result-link:hover {
    background-color: var(--hover-bg);
  }

  .search-result-title {
    font-weight: 600;
    font-size: var(--font-size-base);
    color: var(--text-color);
    margin-bottom: 0.25rem;
    line-height: 1.4;
  }

  .search-result-excerpt {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .search-result-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: var(--font-size-xs);
    color: var(--text-muted);
  }

  .search-result-date {
    display: flex;
    align-items: center;
  }

  .search-result-date::before {
    content: 'ğŸ“…';
    margin-right: 0.25rem;
  }

  .search-result-category {
    display: flex;
    align-items: center;
    padding: 0.125rem 0.5rem;
    background-color: var(--tag-bg);
    color: var(--tag-color);
    border-radius: var(--border-radius);
    font-size: var(--font-size-xs);
  }

  .search-result-category::before {
    content: 'ğŸ·ï¸';
    margin-right: 0.25rem;
  }

  /* æœç´¢é«˜äº®æ ·å¼ */
  .search-results mark {
    background-color: var(--primary-color);
    color: white;
    padding: 0.125rem 0.25rem;
    border-radius: 0.125rem;
    font-weight: 600;
  }

  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 1199px) {
    .sidebar-toggle {
      display: block;
    }
  }

  @media (max-width: 768px) {
    .topbar-inner {
      padding: 0 1rem;
    }

    .breadcrumb {
      display: none;
    }
  }
</style>

<script>
  // ä¾§è¾¹æ åˆ‡æ¢
  document.addEventListener('DOMContentLoaded', () => {
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');

    function toggleSidebar() {
      sidebar?.classList.toggle('show');
      sidebarOverlay?.classList.toggle('show');
    }

    sidebarToggle?.addEventListener('click', toggleSidebar);
    sidebarOverlay?.addEventListener('click', toggleSidebar);

    // ä¸»é¢˜åˆ‡æ¢
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    function updateThemeIcon(isDark: boolean) {
      // ä½¿ç”¨å›ºå®šçš„å¯¹æ¯”åº¦å›¾æ ‡ï¼Œä¸å†åˆ‡æ¢å¤ªé˜³/æœˆäº®ç±»å
      if (themeIcon) {
        themeIcon.setAttribute('data-theme', isDark ? 'dark' : 'light');
      }
    }

    // åˆå§‹åŒ–ä¸»é¢˜å›¾æ ‡
    const currentTheme = localStorage.getItem('theme') || 'light';
    updateThemeIcon(currentTheme === 'dark');

    themeToggle?.addEventListener('click', () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const newTheme = isDark ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme === 'dark');
    });

    // æœç´¢åŠŸèƒ½
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const searchClear = document.getElementById('search-clear');
    const searchResults = document.getElementById('search-results');
    
    if (searchInput && searchClear && searchResults) {
      let searchTimeout: NodeJS.Timeout;
      
      // æœç´¢è¾“å…¥å¤„ç†
      searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        if (query.length > 0) {
          searchClear.classList.add('show');
          
          // é˜²æŠ–æœç´¢
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            performSearch(query);
          }, 300);
        } else {
          searchClear.classList.remove('show');
          searchResults.classList.remove('show');
        }
      });
      
      // æ¸…é™¤æœç´¢
      searchClear.addEventListener('click', function() {
        searchInput.value = '';
        searchClear.classList.remove('show');
        searchResults.classList.remove('show');
        searchInput.focus();
      });
      
      // ç‚¹å‡»å¤–éƒ¨å…³é—­æœç´¢ç»“æœ
      document.addEventListener('click', function(e) {
        if (!(e.target as Element).closest('.search-container')) {
          searchResults.classList.remove('show');
        }
      });
      
      // é”®ç›˜å¯¼èˆªæ”¯æŒ
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchResults.classList.remove('show');
          searchInput.blur();
        }
      });
    }

    // åŠ¨æ€é¢åŒ…å±‘å¯¼èˆª
    const breadcrumbList = document.getElementById('breadcrumb-list');
    if (breadcrumbList) {
      const currentPath = window.location.pathname;
      const pathSegments = currentPath.split('/').filter(segment => segment);
      
      // æ¸…é™¤é»˜è®¤é¢åŒ…å±‘ï¼ˆä¿ç•™é¦–é¡µï¼‰
      const homeItem = breadcrumbList.querySelector('.breadcrumb-item');
      breadcrumbList.innerHTML = '';
      if (homeItem) {
        breadcrumbList.appendChild(homeItem);
      }
      
      // æ ¹æ®è·¯å¾„ç”Ÿæˆé¢åŒ…å±‘
      let currentUrl = '';
      pathSegments.forEach((segment, index) => {
        currentUrl += '/' + segment;
        const isLast = index === pathSegments.length - 1;
        
        // å¯¹äºåšå®¢æ–‡ç« é¡µé¢ï¼Œè·³è¿‡ "blog" æ®µï¼Œç›´æ¥æ˜¾ç¤ºæ–‡ç« æ ‡é¢˜
        if (segment === 'blog' && pathSegments.length > 1) {
          return; // è·³è¿‡ blog æ®µ
        }
        
        const li = document.createElement('li');
        li.className = 'breadcrumb-item';
        
        let displayName = segment;
        let linkUrl = currentUrl;
        
        // URLè§£ç å¤„ç†ä¸­æ–‡å­—ç¬¦
        try {
          displayName = decodeURIComponent(segment);
        } catch (e) {
          // å¦‚æœè§£ç å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²
          displayName = segment;
        }
        
        // è‡ªå®šä¹‰æ˜¾ç¤ºåç§°
        if (segment === 'categories') displayName = 'åˆ†ç±»';
        else if (segment === 'tags') displayName = 'æ ‡ç­¾';
        else if (segment === 'archives') displayName = 'å½’æ¡£';
        else if (segment === 'about') displayName = 'å…³äº';
        else if (pathSegments[0] === 'blog' && isLast) {
          // å¦‚æœæ˜¯åšå®¢æ–‡ç« é¡µé¢çš„æœ€åä¸€æ®µï¼ˆæ–‡ç« æ ‡é¢˜ï¼‰ï¼Œæ ¼å¼åŒ–æ˜¾ç¤º
          if (displayName.includes('-')) {
            displayName = displayName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
          }
        }
        
        // åœ¨æ¯ä¸ªé¢åŒ…å±‘é¡¹ä¹‹å‰åŠ å…¥åˆ†éš”ç¬¦ï¼ˆé¦–é¡µåé¢å¼€å§‹ï¼‰
        const sep = document.createElement('li');
        sep.className = 'breadcrumb-sep';
        sep.textContent = '/';
        breadcrumbList.appendChild(sep);

        if (isLast) {
          li.innerHTML = `<span>${displayName}</span>`;
        } else {
          // åœ¨è¯¦æƒ…é¡µï¼Œå°†â€œåˆ†ç±»/æ ‡ç­¾â€æ˜¾ç¤ºä¸ºæ™®é€šæ–‡æœ¬
          if ((segment === 'categories' || segment === 'tags') && pathSegments.length > index + 1) {
            li.innerHTML = `<span>${displayName}</span>`;
          } else {
            li.innerHTML = `<a href="${linkUrl}">${displayName}</a>`;
          }
        }

        breadcrumbList.appendChild(li);

        // ä¿è¯é™¤æœ€åä¸€æ®µå¤–å‡ä¸ºå¯ç‚¹å‡»é“¾æ¥ï¼ˆå›é€€å¤„ç†ï¼‰
        if (!isLast && li.querySelector('span')) {
          li.innerHTML = `<a href="${linkUrl}">${displayName}</a>`;
        }
      });
    }
  });

  // æ‰§è¡Œæœç´¢
  async function performSearch(query: string) {
    const searchResults = document.getElementById('search-results');
    if (!searchResults) return;
    
    try {
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      searchResults.innerHTML = '<div class="search-loading">æœç´¢ä¸­...</div>';
      searchResults.classList.add('show');
      
      // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æœç´¢APIï¼Œç°åœ¨å…ˆç”¨æ¨¡æ‹Ÿæ•°æ®
      const results = await mockSearch(query);
      
      if (results.length > 0) {
        searchResults.innerHTML = results.map(result => `
          <div class="search-result-item">
            <a href="${result.url}" class="search-result-link">
              <div class="search-result-title">${highlightText(result.title, query)}</div>
              <div class="search-result-excerpt">${highlightText(result.excerpt, query)}</div>
              <div class="search-result-meta">
                <span class="search-result-date">${result.date}</span>
                ${result.category ? `<span class="search-result-category">${result.category}</span>` : ''}
              </div>
            </a>
          </div>
        `).join('');
      } else {
        searchResults.innerHTML = '<div class="search-no-results">æœªæ‰¾åˆ°ç›¸å…³æ–‡ç« </div>';
      }
      
      searchResults.classList.add('show');
    } catch (error) {
      console.error('æœç´¢å‡ºé”™:', error);
      searchResults.innerHTML = '<div class="search-error">æœç´¢å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•</div>';
      searchResults.classList.add('show');
    }
  }

  // æ¨¡æ‹Ÿæœç´¢å‡½æ•°ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥æ›¿æ¢ä¸ºçœŸå®çš„æœç´¢é€»è¾‘ï¼‰
  async function mockSearch(query: string) {
    // æ¨¡æ‹ŸAPIå»¶è¿Ÿ
    await new Promise(resolve => setTimeout(resolve, 200));
    
    // æ¨¡æ‹Ÿæœç´¢ç»“æœ
    const mockData = [
      { 
        title: 'Astro é™æ€ç«™ç‚¹ç”Ÿæˆå™¨å…¥é—¨', 
        excerpt: 'å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Astro æ„å»ºç°ä»£é™æ€ç½‘ç«™ï¼ŒåŒ…æ‹¬ç»„ä»¶ç³»ç»Ÿã€å†…å®¹é›†åˆç­‰æ ¸å¿ƒæ¦‚å¿µã€‚', 
        url: '/blog/astro-getting-started/',
        date: '2024-01-15',
        category: 'å‰ç«¯å¼€å‘'
      },
      { 
        title: 'TypeScript æœ€ä½³å®è·µæŒ‡å—', 
        excerpt: 'æ·±å…¥äº†è§£ TypeScript çš„é«˜çº§ç‰¹æ€§å’Œæœ€ä½³å®è·µï¼Œæå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚', 
        url: '/blog/typescript-best-practices/',
        date: '2024-01-10',
        category: 'ç¼–ç¨‹è¯­è¨€'
      },
      { 
        title: 'CSS Grid å¸ƒå±€å®Œå…¨æŒ‡å—', 
        excerpt: 'æŒæ¡ CSS Grid å¸ƒå±€ç³»ç»Ÿï¼Œåˆ›å»ºå¤æ‚è€Œçµæ´»çš„ç½‘é¡µå¸ƒå±€ã€‚', 
        url: '/blog/css-grid-guide/',
        date: '2024-01-05',
        category: 'å‰ç«¯å¼€å‘'
      }
    ];
    
    return mockData.filter(item => 
      item.title.toLowerCase().includes(query.toLowerCase()) ||
      item.excerpt.toLowerCase().includes(query.toLowerCase()) ||
      item.category.toLowerCase().includes(query.toLowerCase())
    );
  }

  // é«˜äº®æœç´¢å…³é”®è¯
  function highlightText(text: string, query: string): string {
    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }
</script>
